<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Bookology - Test Chapter 1 Streaming</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 24px; color: #0a0a0a; }
        #output { border: 1px solid #e5e7eb; padding: 16px; min-height: 320px; background: #fafafa; white-space: pre-wrap; }
        button { padding: 10px 16px; font-size: 15px; margin: 8px 8px 16px 0; cursor: pointer; }
        .token { color: #111827; }
        .chapter-done { color: #16a34a; font-weight: 600; }
        .choices { color: #2563eb; font-weight: 600; }
        .error { color: #dc2626; }
        .row { margin: 8px 0; }
        textarea { width: 100%; min-height: 140px; font-family: inherit; font-size: 14px; padding: 8px; }
        input { padding: 8px; font-size: 14px; width: 140px; }
        label { font-size: 14px; color: #374151; }
    </style>
</head>
<body>
    <h1>Chapter 1 Generation Test (non-stream)</h1>
    <p>Streaming has been removed. Use <code>/lc_generate_chapter</code> to get the full chapter at once.</p>

    <div class="row">
        <label>API URL</label><br />
        <input id="api" value="http://127.0.0.1:8000/lc_generate_chapter" />
    </div>
    <div class="row">
        <label>Story ID</label><br />
        <input id="storyId" value="123" />
    </div>
    <div class="row">
        <label>Outline</label><br />
        <textarea id="outline">A young explorer discovers an ancient civilization hidden in the Amazon rainforest. The story follows their journey through mysterious ruins, encounters with indigenous tribes, and the discovery of a powerful artifact that could change the world. The explorer must navigate dangerous terrain, solve ancient puzzles, and make difficult choices about whether to share their discovery with the outside world or protect the secrets they've uncovered.</textarea>
    </div>

    <button onclick="generateFull()">Generate Chapter 1</button>
    <button onclick="clearOutput()">Clear Output</button>

    <div id="output">Ready to test streaming...</div>

    <script>
        async function generateFull() {
            const output = document.getElementById('output');
            const api = document.getElementById('api').value.trim();
            const storyId = parseInt(document.getElementById('storyId').value, 10) || null;
            const outline = document.getElementById('outline').value.trim();

            output.textContent = 'Generating...\n\n';

            try {
                const response = await fetch(api, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ outline, chapter_number: 1, story_id: storyId })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                const data = await response.json();
                output.textContent += `Chapter received (length: ${(data?.chapter || '').length})\n`;
                output.textContent += `\n--- Chapter ---\n\n`;
                output.textContent += (data?.chapter || '') + '\n\n';
                const choices = data?.choices || [];
                if (choices.length) {
                    output.textContent += '--- Choices ---\n';
                    choices.forEach((c, i) => {
                        output.textContent += `${i + 1}. ${c.title}\n   ${c.description}\n\n`;
                    });
                }
            } catch (err) {
                output.innerHTML += `<span class="error">${err.message}</span>\n`;
                console.error(err);
            }
        }

        function clearOutput() {
            document.getElementById('output').textContent = 'Ready to test streaming...';
        }
    </script>
</body>
</html>





